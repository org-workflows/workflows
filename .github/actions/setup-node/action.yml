name: 'Setup Node.js Environment'
description: 'Node.js í™˜ê²½ì„ ì„¤ì •í•˜ê³  ì˜ì¡´ì„±ì„ ìºì‹œí•©ë‹ˆë‹¤'
author: 'ldmrepo'

branding:
  icon: 'package'
  color: 'green'

inputs:
  node-version:
    description: 'Node.js ë²„ì „'
    required: false
    default: '20'

  package-manager:
    description: 'íŒ¨í‚¤ì§€ ë§¤ë‹ˆì € (npm, yarn, pnpm)'
    required: false
    default: 'npm'

  working-directory:
    description: 'ì‘ì—… ë””ë ‰í† ë¦¬'
    required: false
    default: '.'

  install-deps:
    description: 'ì˜ì¡´ì„± ì„¤ì¹˜ ì—¬ë¶€'
    required: false
    default: 'true'

  registry-url:
    description: 'npm ë ˆì§€ìŠ¤íŠ¸ë¦¬ URL'
    required: false
    default: ''

outputs:
  node-version:
    description: 'ì„¤ì¹˜ëœ Node.js ë²„ì „'
    value: ${{ steps.setup-node.outputs.node-version }}

  cache-hit:
    description: 'ìºì‹œ íˆíŠ¸ ì—¬ë¶€'
    value: ${{ steps.setup-node.outputs.cache-hit }}

runs:
  using: 'composite'
  steps:
    - name: Setup pnpm
      if: ${{ inputs.package-manager == 'pnpm' }}
      uses: pnpm/action-setup@v2
      with:
        version: 8

    - name: Setup Node.js
      id: setup-node
      uses: actions/setup-node@v4
      with:
        node-version: ${{ inputs.node-version }}
        cache: ${{ inputs.package-manager }}
        cache-dependency-path: |
          ${{ inputs.working-directory }}/package-lock.json
          ${{ inputs.working-directory }}/yarn.lock
          ${{ inputs.working-directory }}/pnpm-lock.yaml
        registry-url: ${{ inputs.registry-url }}

    - name: Install Dependencies (npm)
      if: ${{ inputs.install-deps == 'true' && inputs.package-manager == 'npm' }}
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: npm ci

    - name: Install Dependencies (yarn)
      if: ${{ inputs.install-deps == 'true' && inputs.package-manager == 'yarn' }}
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: yarn install --frozen-lockfile

    - name: Install Dependencies (pnpm)
      if: ${{ inputs.install-deps == 'true' && inputs.package-manager == 'pnpm' }}
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: pnpm install --frozen-lockfile

    - name: Print Environment Info
      shell: bash
      run: |
        echo "ğŸ“¦ Node.js: $(node --version)"
        echo "ğŸ“¦ npm: $(npm --version)"
        if command -v yarn &> /dev/null; then echo "ğŸ“¦ Yarn: $(yarn --version)"; fi
        if command -v pnpm &> /dev/null; then echo "ğŸ“¦ pnpm: $(pnpm --version)"; fi
